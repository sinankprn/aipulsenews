<div id="newsletter-slide" class="newsletter-slide" role="complementary" aria-label="Newsletter subscription">
  <div class="newsletter-slide-content">
    <div class="newsletter-slide-text">
      <span class="newsletter-slide-icon" aria-hidden="true">&#9889;</span>
      <span class="newsletter-slide-msg"><strong>Enjoying this?</strong> Get weekly AI insights in your inbox.</span>
    </div>
    <form
      action="https://buttondown.com/api/emails/embed-subscribe/sinankprn"
      method="post"
      target="popupwindow"
      onsubmit="window.open('https://buttondown.com/sinankprn', 'popupwindow')"
      class="newsletter-slide-form"
    >
      <input type="email" name="email" placeholder="Your email" required aria-label="Email address">
      <button type="submit">Subscribe</button>
    </form>
    <button class="newsletter-slide-dismiss" aria-label="Dismiss" onclick="dismissNewsletterSlide()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>
</div>

<script>
(function() {
  var slideEl = document.getElementById('newsletter-slide');
  if (!slideEl) return;

  var STORAGE_KEY = 'newsletter-slide-dismissed';

  // Check if previously dismissed
  if (localStorage.getItem(STORAGE_KEY)) {
    slideEl.remove();
    return;
  }

  function getScrollPercent() {
    var docHeight = Math.max(
      document.body.scrollHeight,
      document.documentElement.scrollHeight
    );
    var winHeight = window.innerHeight;
    var scrollTop = window.scrollY || document.documentElement.scrollTop;
    var scrollable = docHeight - winHeight;

    if (scrollable <= 0) return 0;
    return (scrollTop / scrollable) * 100;
  }

  function checkScroll() {
    var percent = getScrollPercent();

    // Show between 40% and 85%
    if (percent >= 40 && percent < 85) {
      slideEl.classList.add('visible');
    } else {
      slideEl.classList.remove('visible');
    }
  }

  // Check on load (in case page is already scrolled)
  checkScroll();

  // Throttled scroll listener
  var ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      requestAnimationFrame(function() {
        checkScroll();
        ticking = false;
      });
      ticking = true;
    }
  }, { passive: true });
})();

function dismissNewsletterSlide() {
  var slideEl = document.getElementById('newsletter-slide');
  if (slideEl) {
    slideEl.classList.remove('visible');
    localStorage.setItem('newsletter-slide-dismissed', 'true');
    setTimeout(function() { slideEl.remove(); }, 300);
  }
}
</script>
